

/**
 * @typedef {Object} PropertiesToAttributes
 * @property {string} accept - Corresponding HTML attribute: accept
 * @property {string} acceptCharset - Corresponding HTML attribute: accept-charset
 * @property {string} accessKey - Corresponding HTML attribute: accesskey
 * @property {string} action - Corresponding HTML attribute: action
 * @property {string} allowFullscreen - Corresponding HTML attribute: allowfullscreen
 * @property {string} alt - Corresponding HTML attribute: alt
 * @property {string} async - Corresponding HTML attribute: async
 * @property {string} autoComplete - Corresponding HTML attribute: autocomplete
 * @property {string} autoFocus - Corresponding HTML attribute: autofocus
 * @property {string} autoPlay - Corresponding HTML attribute: autoplay
 * @property {string} capture - Corresponding HTML attribute: capture
 * @property {string} cellPadding - Corresponding HTML attribute: cellpadding
 * @property {string} cellSpacing - Corresponding HTML attribute: cellspacing
 * @property {string} challenge - Corresponding HTML attribute: challenge
 * @property {string} checked - Corresponding HTML attribute: checked
 * @property {string} cite - Corresponding HTML attribute: cite
 * @property {string} class - Corresponding HTML attribute: class
 * @property {string} className - Corresponding HTML attribute: class
 * @property {string} cols - Corresponding HTML attribute: cols
 * @property {string} colSpan - Corresponding HTML attribute: colspan
 * @property {string} content - Corresponding HTML attribute: content
 * @property {string} contentEditable - Corresponding HTML attribute: contenteditable
 * @property {string} controls - Corresponding HTML attribute: controls
 * @property {string} coords - Corresponding HTML attribute: coords
 * @property {string} crossorigin - Corresponding HTML attribute: crossorigin
 * @property {string} data - Corresponding HTML attribute: data
 * @property {string} dateTime - Corresponding HTML attribute: datetime
 * @property {string} default - Corresponding HTML attribute: default
 * @property {string} defer - Corresponding HTML attribute: defer
 * @property {string} dir - Corresponding HTML attribute: dir
 * @property {string} disabled - Corresponding HTML attribute: disabled
 * @property {string} download - Corresponding HTML attribute: download
 * @property {string} draggable - Corresponding HTML attribute: draggable
 * @property {string} enctype - Corresponding HTML attribute: enctype
 * @property {string} form - Corresponding HTML attribute: form
 * @property {string} formAction - Corresponding HTML attribute: formaction
 * @property {string} headers - Corresponding HTML attribute: headers
 * @property {string} height - Corresponding HTML attribute: height
 * @property {string} hidden - Corresponding HTML attribute: hidden
 * @property {string} high - Corresponding HTML attribute: high
 * @property {string} href - Corresponding HTML attribute: href
 * @property {string} hreflang - Corresponding HTML attribute: hreflang
 * @property {string} htmlFor - Corresponding HTML attribute: for
 * @property {string} httpEquiv - Corresponding HTML attribute: http-equiv
 * @property {string} icon - Corresponding HTML attribute: icon
 * @property {string} id - Corresponding HTML attribute: id
 * @property {string} inputMode - Corresponding HTML attribute: inputmode
 * @property {string} integrity - Corresponding HTML attribute: integrity
 * @property {string} isMap - Corresponding HTML attribute: ismap
 * @property {string} kind - Corresponding HTML attribute: kind
 * @property {string} label - Corresponding HTML attribute: label
 * @property {string} lang - Corresponding HTML attribute: lang
 * @property {string} list - Corresponding HTML attribute: list
 * @property {string} loop - Corresponding HTML attribute: loop
 * @property {string} low - Corresponding HTML attribute: low
 * @property {string} manifest - Corresponding HTML attribute: manifest
 * @property {string} marginHeight - Corresponding HTML attribute: marginheight
 * @property {string} marginWidth - Corresponding HTML attribute: marginwidth
 * @property {string} max - Corresponding HTML attribute: max
 * @property {string} maxLength - Corresponding HTML attribute: maxlength
 * @property {string} media - Corresponding HTML attribute: media
 * @property {string} method - Corresponding HTML attribute: method
 * @property {string} min - Corresponding HTML attribute: min
 * @property {string} minLength - Corresponding HTML attribute: minlength
 * @property {string} multiple - Corresponding HTML attribute: multiple
 * @property {string} muted - Corresponding HTML attribute: muted
 * @property {string} name - Corresponding HTML attribute: name
 * @property {string} noValidate - Corresponding HTML attribute: novalidate
 * @property {string} open - Corresponding HTML attribute: open
 * @property {string} optimum - Corresponding HTML attribute: optimum
 * @property {string} pattern - Corresponding HTML attribute: pattern
 * @property {string} placeholder - Corresponding HTML attribute: placeholder
 * @property {string} poster - Corresponding HTML attribute: poster
 * @property {string} preload - Corresponding HTML attribute: preload
 * @property {string} readOnly - Corresponding HTML attribute: readonly
 * @property {string} rel - Corresponding HTML attribute: rel
 * @property {string} required - Corresponding HTML attribute: required
 * @property {string} reversed - Corresponding HTML attribute: reversed
 * @property {string} rows - Corresponding HTML attribute: rows
 * @property {string} rowSpan - Corresponding HTML attribute: rowspan
 * @property {string} sandbox - Corresponding HTML attribute: sandbox
 * @property {string} scope - Corresponding HTML attribute: scope
 * @property {string} scoped - Corresponding HTML attribute: scoped
 * @property {string} scrolling - Corresponding HTML attribute: scrolling
 * @property {string} seamless - Corresponding HTML attribute: seamless
 * @property {string} selected - Corresponding HTML attribute: selected
 * @property {string} shape - Corresponding HTML attribute: shape
 * @property {string} size - Corresponding HTML attribute: size
 * @property {string} sizes - Corresponding HTML attribute: sizes
 * @property {string} span - Corresponding HTML attribute: span
 * @property {string} spellcheck - Corresponding HTML attribute: spellcheck
 * @property {string} src - Corresponding HTML attribute: src
 * @property {string} srcdoc - Corresponding HTML attribute: srcdoc
 * @property {string} srclang - Corresponding HTML attribute: srclang
 * @property {string} srcset - Corresponding HTML attribute: srcset
 * @property {string} start - Corresponding HTML attribute: start
 * @property {string} step - Corresponding HTML attribute: step
 * @property {string} style - Corresponding HTML attribute: style
 * @property {string} summary - Corresponding HTML attribute: summary
 * @property {string} tabIndex - Corresponding HTML attribute: tabindex
 * @property {string} target - Corresponding HTML attribute: target
 * @property {string} title - Corresponding HTML attribute: title
 * @property {string} type - Corresponding HTML attribute: type
 * @property {string} useMap - Corresponding HTML attribute: usemap
 * @property {string} value - Corresponding HTML attribute: value
 * @property {string} width - Corresponding HTML attribute: width
 * @property {string} wrap - Corresponding HTML attribute: wrap
 */

/**
 * @typedef {Object} PropertiesToEvents
 * @property {string} onAbort - Corresponding JavaScript event: abort
 * @property {string} onAnimationCancel - Corresponding JavaScript event: animationcancel
 * @property {string} onAnimationEnd - Corresponding JavaScript event: animationend
 * @property {string} onAnimationIteration - Corresponding JavaScript event: animationiteration
 * @property {string} onAnimationStart - Corresponding JavaScript event: animationstart
 * @property {string} onAuxClick - Corresponding JavaScript event: auxclick
 * @property {string} onBeforeInput - Corresponding JavaScript event: beforeinput
 * @property {string} onBlur - Corresponding JavaScript event: blur
 * @property {string} onCancel - Corresponding JavaScript event: cancel
 * @property {string} onCanPlay - Corresponding JavaScript event: canplay
 * @property {string} onCanPlayThrough - Corresponding JavaScript event: canplaythrough
 * @property {string} onChange - Corresponding JavaScript event: change
 * @property {string} onClick - Corresponding JavaScript event: click
 * @property {string} onClose - Corresponding JavaScript event: close
 * @property {string} onContextMenu - Corresponding JavaScript event: contextmenu
 * @property {string} onCopy - Corresponding JavaScript event: copy
 * @property {string} onCueChange - Corresponding JavaScript event: cuechange
 * @property {string} onCut - Corresponding JavaScript event: cut
 * @property {string} onDoubleClick - Corresponding JavaScript event: doubleclick
 * @property {string} onDrag - Corresponding JavaScript event: drag
 * @property {string} onDragEnd - Corresponding JavaScript event: dragend
 * @property {string} onDragEnter - Corresponding JavaScript event: dragenter
 * @property {string} onDragExit - Corresponding JavaScript event: dragexit
 * @property {string} onDragLeave - Corresponding JavaScript event: dragleave
 * @property {string} onDragOver - Corresponding JavaScript event: dragover
 * @property {string} onDragStart - Corresponding JavaScript event: dragstart
 * @property {string} onDrop - Corresponding JavaScript event: drop
 * @property {string} onDurationChange - Corresponding JavaScript event: durationchange
 * @property {string} onEmptied - Corresponding JavaScript event: emptied
 * @property {string} onEnded - Corresponding JavaScript event: ended
 * @property {string} onError - Corresponding JavaScript event: error
 * @property {string} onFocus - Corresponding JavaScript event: focus
 * @property {string} onFocusIn - Corresponding JavaScript event: focusin
 * @property {string} onFocusOut - Corresponding JavaScript event: focusout
 * @property {string} onFullScreenChange - Corresponding JavaScript event: fullscreenchange
 * @property {string} onFullScreenError - Corresponding JavaScript event: fullscreenerror
 * @property {string} onGotPointerCapture - Corresponding JavaScript event: gotpointercapture
 * @property {string} onInput - Corresponding JavaScript event: input
 * @property {string} onInvalid - Corresponding JavaScript event: invalid
 * @property {string} onKeyDown - Corresponding JavaScript event: keydown
 * @property {string} onKeyPress - Corresponding JavaScript event: keypress
 * @property {string} onKeyUp - Corresponding JavaScript event: keyup
 * @property {string} onLoad - Corresponding JavaScript event: load
 * @property {string} onLoadedData - Corresponding JavaScript event: loadeddata
 * @property {string} onLoadedMetadata - Corresponding JavaScript event: loadedmetadata
 * @property {string} onLoadEnd - Corresponding JavaScript event: loadend
 * @property {string} onLoadStart - Corresponding JavaScript event: loadstart
 * @property {string} onLostPointerCapture - Corresponding JavaScript event: lostpointercapture
 * @property {string} onMouseDown - Corresponding JavaScript event: mousedown
 * @property {string} onMouseEnter - Corresponding JavaScript event: mouseenter
 * @property {string} onMouseLeave - Corresponding JavaScript event: mouseleave
 * @property {string} onMouseMove - Corresponding JavaScript event: mousemove
 * @property {string} onMouseOut - Corresponding JavaScript event: mouseout
 * @property {string} onMouseOver - Corresponding JavaScript event: mouseover
 * @property {string} onMouseUp - Corresponding JavaScript event: mouseup
 * @property {string} onPaste - Corresponding JavaScript event: paste
 * @property {string} onPause - Corresponding JavaScript event: pause
 * @property {string} onPlay - Corresponding JavaScript event: play
 * @property {string} onPlaying - Corresponding JavaScript event: playing
 * @property {string} onPointerCancel - Corresponding JavaScript event: pointercancel
 * @property {string} onPointerDown - Corresponding JavaScript event: pointerdown
 * @property {string} onPointerEnter - Corresponding JavaScript event: pointerenter
 * @property {string} onPointerLeave - Corresponding JavaScript event: pointerleave
 * @property {string} onPointerMove - Corresponding JavaScript event: pointermove
 * @property {string} onPointerOut - Corresponding JavaScript event: pointerout
 * @property {string} onPointerOver - Corresponding JavaScript event: pointerover
 * @property {string} onPointerUp - Corresponding JavaScript event: pointerup
 * @property {string} onProgress - Corresponding JavaScript event: progress
 * @property {string} onRateChange - Corresponding JavaScript event: ratechange
 * @property {string} onReset - Corresponding JavaScript event: reset
 * @property {string} onResize - Corresponding JavaScript event: resize
 * @property {string} onScroll - Corresponding JavaScript event: scroll
 * @property {string} onSecurityPolicyViolation - Corresponding JavaScript event: securitypolicyviolation
 * @property {string} onSeeked - Corresponding JavaScript event: seeked
 * @property {string} onSeeking - Corresponding JavaScript event: seeking
 * @property {string} onSelect - Corresponding JavaScript event: select
 * @property {string} onSelectionChange - Corresponding JavaScript event: selectionchange
 * @property {string} onSelectStart - Corresponding JavaScript event: selectstart
 * @property {string} onStalled - Corresponding JavaScript event: stalled
 * @property {string} onSubmit - Corresponding JavaScript event: submit
 * @property {string} onSuspend - Corresponding JavaScript event: suspend
 * @property {string} onTimeUpdate - Corresponding JavaScript event: timeupdate
 * @property {string} onToggle - Corresponding JavaScript event: toggle
 * @property {string} onTouchCancel - Corresponding JavaScript event: touchcancel
 * @property {string} onTouchEnd - Corresponding JavaScript event: touchend
 */

/**
 * @typedef {string | HTMLElement | number} Children
 */

const propertiesToAttributes = {
    accept: "accept",
    acceptCharset: "accept-charset",
    accessKey: "accesskey",
    action: "action",
    allowFullscreen: "allowfullscreen",
    alt: "alt",
    async: "async",
    autoComplete: "autocomplete",
    autoFocus: "autofocus",
    autoPlay: "autoplay",
    capture: "capture",
    cellPadding: "cellpadding",
    cellSpacing: "cellspacing",
    challenge: "challenge",
    checked: "checked",
    cite: "cite",
    class: "class",
    className: "class",
    cols: "cols",
    colSpan: "colspan",
    content: "content",
    contentEditable: "contenteditable",
    controls: "controls",
    coords: "coords",
    crossorigin: "crossorigin",
    data: "data",
    dateTime: "datetime",
    default: "default",
    defer: "defer",
    dir: "dir",
    disabled: "disabled",
    download: "download",
    draggable: "draggable",
    enctype: "enctype",
    form: "form",
    formAction: "formaction",
    headers: "headers",
    height: "height",
    hidden: "hidden",
    high: "high",
    href: "href",
    hreflang: "hreflang",
    htmlFor: "for",
    httpEquiv: "http-equiv",
    icon: "icon",
    id: "id",
    inputMode: "inputmode",
    integrity: "integrity",
    isMap: "ismap",
    kind: "kind",
    label: "label",
    lang: "lang",
    list: "list",
    loop: "loop",
    low: "low",
    manifest: "manifest",
    marginHeight: "marginheight",
    marginWidth: "marginwidth",
    max: "max",
    maxLength: "maxlength",
    media: "media",
    method: "method",
    min: "min",
    minLength: "minlength",
    multiple: "multiple",
    muted: "muted",
    name: "name",
    noValidate: "novalidate",
    open: "open",
    optimum: "optimum",
    pattern: "pattern",
    placeholder: "placeholder",
    poster: "poster",
    preload: "preload",
    readOnly: "readonly",
    rel: "rel",
    required: "required",
    reversed: "reversed",
    rows: "rows",
    rowSpan: "rowspan",
    sandbox: "sandbox",
    scope: "scope",
    scoped: "scoped",
    scrolling: "scrolling",
    seamless: "seamless",
    selected: "selected",
    shape: "shape",
    size: "size",
    sizes: "sizes",
    span: "span",
    spellcheck: "spellcheck",
    src: "src",
    srcdoc: "srcdoc",
    srclang: "srclang",
    srcset: "srcset",
    start: "start",
    step: "step",
    style: "style",
    summary: "summary",
    tabIndex: "tabindex",
    target: "target",
    title: "title",
    type: "type",
    useMap: "usemap",
    value: "value",
    width: "width",
    wrap: "wrap"
};

const attributesToEvents = {
    onAbort: "abort",
    onAnimationCancel: "animationcancel",
    onAnimationEnd: "animationend",
    onAnimationIteration: "animationiteration",
    onAnimationStart: "animationstart",
    onAuxClick: "auxclick",
    onBeforeInput: "beforeinput",
    onBlur: "blur",
    onCancel: "cancel",
    onCanPlay: "canplay",
    onCanPlayThrough: "canplaythrough",
    onChange: "change",
    onClick: "click",
    onClose: "close",
    onContextMenu: "contextmenu",
    onCopy: "copy",
    onCueChange: "cuechange",
    onCut: "cut",
    onDoubleClick: "doubleclick",
    onDrag: "drag",
    onDragEnd: "dragend",
    onDragEnter: "dragenter",
    onDragExit: "dragexit",
    onDragLeave: "dragleave",
    onDragOver: "dragover",
    onDragStart: "dragstart",
    onDrop: "drop",
    onDurationChange: "durationchange",
    onEmptied: "emptied",
    onEnded: "ended",
    onError: "error",
    onFocus: "focus",
    onFocusIn: "focusin",
    onFocusOut: "focusout",
    onFullScreenChange: "fullscreenchange",
    onFullScreenError: "fullscreenerror",
    onGotPointerCapture: "gotpointercapture",
    onInput: "input",
    onInvalid: "invalid",
    onKeyDown: "keydown",
    onKeyPress: "keypress",
    onKeyUp: "keyup",
    onLoad: "load",
    onLoadedData: "loadeddata",
    onLoadedMetadata: "loadedmetadata",
    onLoadEnd: "loadend",
    onLoadStart: "loadstart",
    onLostPointerCapture: "lostpointercapture",
    onMouseDown: "mousedown",
    onMouseEnter: "mouseenter",
    onMouseLeave: "mouseleave",
    onMouseMove: "mousemove",
    onMouseOut: "mouseout",
    onMouseOver: "mouseover",
    onMouseUp: "mouseup",
    onPaste: "paste",
    onPause: "pause",
    onPlay: "play",
    onPlaying: "playing",
    onPointerCancel: "pointercancel",
    onPointerDown: "pointerdown",
    onPointerEnter: "pointerenter",
    onPointerLeave: "pointerleave",
    onPointerMove: "pointermove",
    onPointerOut: "pointerout",
    onPointerOver: "pointerover",
    onPointerUp: "pointerup",
    onProgress: "progress",
    onRateChange: "ratechange",
    onReset: "reset",
    onResize: "resize",
    onScroll: "scroll",
    onSecurityPolicyViolation: "securitypolicyviolation",
    onSeeked: "seeked",
    onSeeking: "seeking",
    onSelect: "select",
    onSelectionChange: "selectionchange",
    onSelectStart: "selectstart",
    onStalled: "stalled",
    onSubmit: "submit",
    onSuspend: "suspend",
    onTimeUpdate: "timeupdate",
    onToggle: "toggle",
    onTouchCancel: "touchcancel",
    onTouchEnd: "touchend"
};

/**
 * Fonction qui renvoie le nom de l'attribut HTML correspondant à la propriété JavaScript donnée.
 * @param {keyof PropertiesToAttributes} property - La propriété JavaScript de l'élément HTML.
 * @returns {string} - Le nom de l'attribut HTML correspondant.
 */
function getPropertyAttribute(property) {
    return propertiesToAttributes[property];
}

/**
 * Fonction qui renvoie le nom de l'événement JavaScript correspondant à la propriété JavaScript donnée.
 * @param {keyof PropertiesToEvents} attribute - L'attribut HTML de l'élément.
 * @returns {string} - Le nom de l'événement JavaScript correspondant.
 */
function getEventFromProperty(attribute) {
    return attributesToEvents[attribute];
}

/**
 * Ajoute des enfants à un élément.
 * @param {HTMLElement} element - L'élément auquel les enfants doivent être ajoutés.
 * @param {Children | Array<Children>} children - Les enfants à ajouter. Cela peut être un enfant unique ou un tableau d'enfants.
 */
function appendChild(element, children) {
    if (Array.isArray(children)) {
      children.forEach((child) => appendChild(element, child));
    } else if (children instanceof Node) {
        element.appendChild(children);
    } else if (typeof children === "string" || typeof children === "number") {
        const textNode = document.createTextNode(children.toString());
        element.appendChild(textNode);
    } else {
        throw new Error("innerHTML must be string, number, Node or an array of these types");
    }
}

/**
 * create an HTMLElement
 * @template {keyof HTMLElementTagNameMap} K
 * @param {K | HTMLElement} tagName
 * @param {Partial<HTMLElementTagNameMap[K]> |Partial<PropertiesToAttributes & PropertiesToEvents> | Children | Array<Children>} [options]
 * @param {Children | Array<Children>} [children]
 * @return {HTMLElementTagNameMap[K]}
 */
function h(tagName, options, children) {
    /** @type {HTMLElement} */
    let element;

    if (tagName instanceof Node) {
        element = tagName;
    } else if (typeof tagName === "string") {
        element = document.createElement(tagName.toLowerCase());
    } else {
        throw new Error("tagName must be a string or an HTMLElement");
    }

    if (options instanceof Node || typeof options === "string" || typeof options === "number" || Array.isArray(options)) {
        children = options;
        options = {};
    }

    // add options
    Object.entries(options || {}).forEach(([key, value]) => {
        if (key.startsWith("on")) {
            element.addEventListener(getEventFromProperty(key), value);
        } else {
            element.setAttribute(getPropertyAttribute(key), value);
        }
    });

    if (children) appendChild(element, children);

    return element;
}

/**
 * render component in element
 * @param {HTMLElement} element
 * @param {Children[]} component
 */
function render(element, ...component) {
    try {
        element.innerHTML = "";
        appendChild(element, component);
    } catch (err) {
        console.warn(err);
    }
    return element;
}

export { h, render };
